{"ast":null,"code":"import $ from 'jquery';\nexport default {\n  state: {\n    id: \"\",\n    username: \"\",\n    photo: \"\",\n    token: \"\",\n    is_login: false,\n    pulling_info: true //正在从云端拉取信息\n\n  },\n  getters: {},\n  mutations: {\n    updateUser(state, user) {\n      state.id = user.id;\n      state.username = user.username;\n      state.photo = user.photo;\n      state.is_login = user.is_login;\n    },\n\n    updateToken(state, token) {\n      state.token = token;\n    },\n\n    logout(state) {\n      state.id = \"\";\n      state.username = \"\";\n      state.photo = \"\";\n      state.token = \"\";\n      state.is_login = false;\n    },\n\n    updatePullingInfo(state, pulling_info) {\n      state.pulling_info = pulling_info;\n    }\n\n  },\n  actions: {\n    login(context, data) {\n      $.ajax({\n        url: \"http://localhost:3000/user/account/token/\",\n        type: \"post\",\n        data: {\n          username: data.username,\n          password: data.password\n        },\n\n        success(resp) {\n          if (resp.error_massage === \"success\") {\n            localStorage.setItem(\"jwt_token\", resp.token);\n            context.commit(\"updateToken\", resp.token);\n            data.success(resp);\n          } else {\n            data.error(resp);\n          }\n        },\n\n        error(resp) {\n          data.error(resp);\n        }\n\n      });\n    },\n\n    getinfo(context, data) {\n      $.ajax({\n        url: \"http://localhost:3000/user/account/info/\",\n        type: \"get\",\n        headers: {\n          Authorization: \"Bearer \" + context.state.token\n        },\n\n        success(resp) {\n          if (resp.error_massage === \"success\") {\n            context.commit(\"updateUser\", { ...resp,\n              //将resp中的\n              is_login: true\n            });\n            data.success(resp);\n          } else {\n            data.error(resp);\n          }\n        },\n\n        error(resp) {\n          data.error(resp);\n        }\n\n      });\n    },\n\n    logout(context) {\n      localStorage.removeItem(\"jwt_token\");\n      context.commit(\"logout\");\n    }\n\n  },\n  modules: {}\n};","map":{"version":3,"names":["$","state","id","username","photo","token","is_login","pulling_info","getters","mutations","updateUser","user","updateToken","logout","updatePullingInfo","actions","login","context","data","ajax","url","type","password","success","resp","error_massage","localStorage","setItem","commit","error","getinfo","headers","Authorization","removeItem","modules"],"sources":["D:/MyAllCoding/SmartCycling/web/src/store/user.js"],"sourcesContent":["import $ from 'jquery'\r\n\r\nexport default {\r\n    state: {\r\n        id: \"\",\r\n        username: \"\",\r\n        photo: \"\",\r\n        token: \"\",\r\n        is_login: false,\r\n        pulling_info: true,//正在从云端拉取信息\r\n    },\r\n    getters: {\r\n    },\r\n    mutations: {\r\n        updateUser(state, user) {\r\n            state.id = user.id;\r\n            state.username = user.username;\r\n            state.photo = user.photo;\r\n            state.is_login = user.is_login;\r\n        },\r\n        updateToken(state, token) {\r\n            state.token = token;\r\n\r\n        },\r\n        logout(state) {\r\n            state.id = \"\";\r\n            state.username = \"\";\r\n            state.photo = \"\";\r\n            state.token = \"\";\r\n            state.is_login = false;\r\n        },\r\n        updatePullingInfo(state, pulling_info) {\r\n            state.pulling_info = pulling_info;\r\n        }\r\n    },\r\n    actions: {\r\n        login(context, data) {\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/account/token/\",\r\n                type: \"post\",\r\n                data: {\r\n                    username: data.username,\r\n                    password: data.password,\r\n                },\r\n                success(resp) {\r\n                    if (resp.error_massage === \"success\") {\r\n                        localStorage.setItem(\"jwt_token\", resp.token);\r\n                        context.commit(\"updateToken\", resp.token);\r\n                        data.success(resp);\r\n                    } else {\r\n                        data.error(resp);\r\n                    }\r\n                },\r\n                error(resp) {\r\n                    data.error(resp);\r\n                }\r\n\r\n            })\r\n\r\n        },\r\n        getinfo(context, data) {\r\n\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/account/info/\",\r\n                type: \"get\",\r\n                headers: {\r\n                    Authorization: \"Bearer \" + context.state.token,\r\n                },\r\n                success(resp) {\r\n\r\n                    if (resp.error_massage === \"success\") {\r\n                        context.commit(\"updateUser\", {\r\n                            ...resp,//将resp中的\r\n                            is_login: true,\r\n                        });\r\n\r\n                        data.success(resp);\r\n                    } else {\r\n                        data.error(resp);\r\n                    }\r\n                },\r\n                error(resp) {\r\n                    data.error(resp);\r\n                }\r\n\r\n            })\r\n        },\r\n        logout(context) {\r\n            localStorage.removeItem(\"jwt_token\");\r\n            context.commit(\"logout\");\r\n        }\r\n    },\r\n    modules: {\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}