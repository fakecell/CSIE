{"ast":null,"code":"import $ from 'jquery';\nimport { useStore } from 'vuex';\nimport { ref, reactive } from 'vue';\nimport { Modal } from 'bootstrap/dist/js/bootstrap';\nimport router from '@/router/index';\nexport default {\n  components: {},\n\n  setup() {\n    let cycles = ref([]);\n    const store = useStore();\n    const cycleAdd = reactive({\n      cname: \"\",\n      ctype: \"\",\n      error_message: \"\"\n    });\n    let latitude = ref('');\n    let longitude = ref('');\n\n    const refresh_cycles = () => {\n      $.ajax({\n        url: \"http://localhost:3000/user/cycle/getList/\",\n        type: \"GET\",\n        headers: {\n          Authorization: \"Bearer \" + store.state.user.token\n        },\n\n        success(resp) {\n          cycles.value = resp;\n        }\n\n      });\n    };\n\n    const add_cycle = () => {\n      cycleAdd.error_message = \"\";\n      $.ajax({\n        url: \"http://localhost:3000/user/cycle/add/\",\n        type: \"POST\",\n        data: {\n          cname: cycleAdd.cname,\n          ctype: cycleAdd.ctype\n        },\n        headers: {\n          Authorization: \"Bearer \" + store.state.user.token\n        },\n\n        success(resp) {\n          console.log(cycleAdd.cname);\n          console.log(resp);\n\n          if (resp.error_message === \"success\") {\n            console.log(\"ok\");\n            cycleAdd.cname = \"\";\n            cycleAdd.ctype = \"\";\n            Modal.getInstance(\"#add-cycle-btn\").hide();\n            refresh_cycles();\n          } else cycleAdd.error_message = resp.error_message;\n        },\n\n        error(resp) {\n          console.log(resp);\n        }\n\n      });\n    };\n\n    const remove_cycle = cycle => {\n      $.ajax({\n        url: \"http://localhost:3000/user/cycle/remove/\",\n        type: \"post\",\n        data: {\n          cycle_id: cycle.id\n        },\n        headers: {\n          Authorization: \"Bearer \" + store.state.user.token\n        },\n\n        success(resp) {\n          if (resp.error_message === \"success\") {\n            refresh_cycles();\n          }\n        }\n\n      });\n    };\n\n    const update_cycle = cycle => {\n      $.ajax({\n        url: \"http://localhost:3000/user/cycle/update/\",\n        type: \"post\",\n        data: {\n          cycle_id: cycle.id,\n          cname: cycleAdd.cname,\n          ctype: cycleAdd.ctype\n        },\n        headers: {\n          Authorization: \"Bearer \" + store.state.user.token\n        },\n\n        success(resp) {\n          console.log(resp);\n\n          if (resp.error_message === \"success\") {\n            Modal.getInstance('#update-cycle-btn-' + cycle.id).hide();\n            refresh_cycles();\n          } else cycle.error_message = resp.error_message;\n        },\n\n        error(resp) {\n          console.log(resp);\n        }\n\n      });\n    };\n\n    const displayLocation = position => {\n      longitude.value = position.coords.longitude, latitude.value = position.coords.latitude;\n    };\n\n    const displayError = () => {};\n\n    const cycle_run = cycle => {\n      navigator.geolocation.getCurrentPosition(displayLocation, displayError);\n      $.ajax({\n        url: \"http://localhost:3000/user/cycle/route/\",\n        type: \"post\",\n        data: {\n          cycle_id: cycle.id,\n          longitude: longitude.value,\n          latitude: latitude.value\n        },\n        headers: {\n          Authorization: \"Bearer \" + store.state.user.token\n        },\n\n        success(resp) {\n          console.log(resp);\n\n          if (resp.error_message === \"success\") {\n            router.push({\n              name: \"cycle_run\"\n            });\n          }\n        },\n\n        error() {\n          console.log(cycle.id);\n          console.log(longitude);\n        }\n\n      });\n    };\n\n    refresh_cycles();\n    return {\n      cycles,\n      cycleAdd,\n      add_cycle,\n      remove_cycle,\n      update_cycle,\n      cycle_run\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["$","useStore","ref","reactive","Modal","router","components","setup","cycles","store","cycleAdd","cname","ctype","error_message","latitude","longitude","refresh_cycles","ajax","url","type","headers","Authorization","state","user","token","success","resp","value","add_cycle","data","console","log","getInstance","hide","error","remove_cycle","cycle","cycle_id","id","update_cycle","displayLocation","position","coords","displayError","cycle_run","navigator","geolocation","getCurrentPosition","push","name"],"sourceRoot":"","sources":["D:\\MyAllCoding\\SmartCycling\\web\\src\\views\\user\\cycles\\UserCycleIndexView.vue"],"sourcesContent":["<template>\r\n\r\n    <div class=\"container\" style=\"margin-top:20px;\">\r\n        <div class=\"row\" style=\"margin-top:20px;\">\r\n            <div class=\"col-12\">\r\n\r\n                <div class=\"card\">\r\n                    <div class=\"card-header\">\r\n                        我的车辆\r\n                        <button type=\"button\" class=\"btn btn-primary float-end\" data-bs-toggle=\"modal\"\r\n                            data-bs-target=\"#add-cycle-btn\">添加车辆</button>\r\n                        <!-- Modal-add -->\r\n                        <div class=\"modal fade\" id=\"add-cycle-btn\" data-bs-backdrop=\"static\" data-bs-keyboard=\"false\"\r\n                            tabindex=\"-1\" aria-labelledby=\"staticBackdropLabel\" aria-hidden=\"true\">\r\n                            <div class=\"modal-dialog modal-dialog-centered\">\r\n                                <div class=\"modal-content\">\r\n                                    <div class=\"modal-header\">\r\n                                        <h5 class=\"modal-title\" id=\"staticBackdropLabel\">添加车辆</h5>\r\n                                        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"\r\n                                            aria-label=\"Close\"></button>\r\n                                    </div>\r\n                                    <div class=\"modal-body\">\r\n                                        <div class=\"mb-3\">\r\n                                            <label for=\"add-cycle-cname\" class=\"form-label\">车辆名称</label>\r\n                                            <input v-model=\"cycleAdd.cname\" type=\"text\" class=\"form-control\"\r\n                                                id=\"add-cycle-cname\" placeholder=\"请输入车辆名称\">\r\n                                        </div>\r\n                                        <div class=\"mb-3\">\r\n                                            <label for=\"add-cycle-type\" class=\"form-label\">车辆类型</label>\r\n                                            <input v-model=\"cycleAdd.ctype\" type=\"text\" class=\"form-control\"\r\n                                                id=\"add-cycle-ctype\" placeholder=\"请输入车辆类型(自行车、电动车)\">\r\n                                        </div>\r\n                                    </div>\r\n                                    <div class=\"modal-footer\">\r\n                                        <div class=\"error-message\">{{ cycleAdd.error_message }}</div>\r\n                                        <button type=\"button\" class=\"btn btn-primary\" @click=\"add_cycle\">添加</button>\r\n                                        <button type=\"button\" class=\"btn btn-secondary\"\r\n                                            data-bs-dismiss=\"modal\">取消</button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <!-- Modal add end -->\r\n\r\n\r\n                        <div class=\"card-body\">\r\n                            <table class=\"table table-striped table-hover\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>名称</th>\r\n                                        <th>类型</th>\r\n                                        <th>骑行状态</th>\r\n                                        <th>其他</th>\r\n                                        <th>操作</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr v-for=\"cycle in cycles\" :key=\"cycle.id\">\r\n                                        <td>{{ cycle.cname }}</td>\r\n                                        <td>{{ cycle.ctype }}</td>\r\n                                        <td>{{ cycle.cstate }}</td>\r\n                                        <td></td>\r\n                                        <td>\r\n                                            <button type=\"button\" class=\"btn btn-secondary\" data-bs-toggle=\"modal\"\r\n                                                :data-bs-target=\"'#update-cycle-btn-' + cycle.id\"\r\n                                                style=\"margin-right:10px;\">修改</button>\r\n\r\n                                            <button type=\"button\" class=\"btn btn-danger\" @click=\"remove_cycle(cycle)\"\r\n                                                style=\"margin-right:10px;\">删除</button>\r\n\r\n                                            <button type=\"button\" class=\"btn btn-primary\"\r\n                                                @click=\"cycle_run(cycle)\">骑行</button>\r\n                                        </td>\r\n\r\n                                        <!-- Modal-update -->\r\n                                        <div class=\"modal fade\" :id=\"'update-cycle-btn-' + cycle.id\"\r\n                                            data-bs-backdrop=\"static\" data-bs-keyboard=\"false\" tabindex=\"-1\"\r\n                                            aria-labelledby=\"staticBackdropLabel\" aria-hidden=\"true\">\r\n                                            <div class=\"modal-dialog modal-dialog-centered\">\r\n                                                <div class=\"modal-content\">\r\n                                                    <div class=\"modal-header\">\r\n                                                        <h5 class=\"modal-title\" id=\"staticBackdropLabel\">修改车辆</h5>\r\n                                                        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"\r\n                                                            aria-label=\"Close\"></button>\r\n                                                    </div>\r\n                                                    <div class=\"modal-body\">\r\n                                                        <div class=\"mb-3\">\r\n                                                            <label for=\"update-cycle-cname\"\r\n                                                                class=\"form-label\">车辆名称</label>\r\n                                                            <input v-model=\"cycleAdd.cname\" type=\"text\"\r\n                                                                class=\"form-control\" id=\"update-cycle-cname\"\r\n                                                                placeholder=\"请修改车辆名称\">\r\n                                                        </div>\r\n                                                        <div class=\"mb-3\">\r\n                                                            <label for=\"update-cycle-type\"\r\n                                                                class=\"form-label\">车辆类型</label>\r\n                                                            <input v-model=\"cycleAdd.ctype\" type=\"text\"\r\n                                                                class=\"form-control\" id=\"update-cycle-ctype\"\r\n                                                                placeholder=\"请修改车辆类型(自行车、电动车)\">\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div class=\"modal-footer\">\r\n                                                        <div class=\"error-message\">{{ cycleAdd.error_message }}</div>\r\n                                                        <button type=\"button\" class=\"btn btn-primary\"\r\n                                                            @click=\"update_cycle(cycle)\">修改</button>\r\n                                                        <button type=\"button\" class=\"btn btn-secondary\"\r\n                                                            data-bs-dismiss=\"modal\">取消</button>\r\n\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <!-- Modal update end -->\r\n\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n\r\n</template>\r\n\r\n\r\n<script>\r\nimport $ from 'jquery'\r\nimport { useStore } from 'vuex'\r\nimport { ref, reactive } from 'vue'\r\nimport { Modal } from 'bootstrap/dist/js/bootstrap'\r\nimport router from '@/router/index'\r\nexport default {\r\n    components: {\r\n\r\n    },\r\n    setup() {\r\n        let cycles = ref([]);\r\n        const store = useStore();\r\n        const cycleAdd = reactive({\r\n            cname: \"\",\r\n            ctype: \"\",\r\n            error_message: \"\",\r\n        })\r\n        let latitude = ref('');\r\n        let longitude = ref('');\r\n        const refresh_cycles = () => {\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/cycle/getList/\",\r\n                type: \"GET\",\r\n                headers: {\r\n                    Authorization: \"Bearer \" + store.state.user.token,\r\n                },\r\n                success(resp) {\r\n                    cycles.value = resp;\r\n                }\r\n            });\r\n        }\r\n\r\n        const add_cycle = () => {\r\n            cycleAdd.error_message = \"\";\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/cycle/add/\",\r\n                type: \"POST\",\r\n                data: {\r\n                    cname: cycleAdd.cname,\r\n                    ctype: cycleAdd.ctype,\r\n                },\r\n                headers: {\r\n                    Authorization: \"Bearer \" + store.state.user.token,\r\n                },\r\n                success(resp) {\r\n                    console.log(cycleAdd.cname);\r\n                    console.log(resp);\r\n                    if (resp.error_message === \"success\") {\r\n                        console.log(\"ok\");\r\n                        cycleAdd.cname = \"\";\r\n                        cycleAdd.ctype = \"\";\r\n                        Modal.getInstance(\"#add-cycle-btn\").hide();\r\n                        refresh_cycles();\r\n                    } else cycleAdd.error_message = resp.error_message;\r\n                },\r\n                error(resp) {\r\n                    console.log(resp);\r\n                }\r\n            });\r\n        }\r\n\r\n        const remove_cycle = (cycle) => {\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/cycle/remove/\",\r\n                type: \"post\",\r\n                data: {\r\n                    cycle_id: cycle.id,\r\n                },\r\n                headers: {\r\n                    Authorization: \"Bearer \" + store.state.user.token,\r\n                },\r\n                success(resp) {\r\n                    if (resp.error_message === \"success\") {\r\n                        refresh_cycles();\r\n                    }\r\n                }\r\n\r\n            });\r\n        }\r\n\r\n        const update_cycle = (cycle) => {\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/cycle/update/\",\r\n                type: \"post\",\r\n                data: {\r\n                    cycle_id: cycle.id,\r\n                    cname: cycleAdd.cname,\r\n                    ctype: cycleAdd.ctype,\r\n                },\r\n                headers: {\r\n                    Authorization: \"Bearer \" + store.state.user.token,\r\n                },\r\n                success(resp) {\r\n                    console.log(resp);\r\n                    if (resp.error_message === \"success\") {\r\n                        Modal.getInstance('#update-cycle-btn-' + cycle.id).hide();\r\n                        refresh_cycles();\r\n                    }\r\n                    else cycle.error_message = resp.error_message;\r\n\r\n                },\r\n                error(resp) {\r\n                    console.log(resp);\r\n                }\r\n            });\r\n        }\r\n        const displayLocation = (position) => {\r\n            longitude.value = position.coords.longitude,\r\n                latitude.value = position.coords.latitude;\r\n        }\r\n        const displayError = () => {\r\n\r\n        }\r\n        const cycle_run = (cycle) => {\r\n            navigator.geolocation.getCurrentPosition(displayLocation, displayError);\r\n            $.ajax({\r\n                url: \"http://localhost:3000/user/cycle/route/\",\r\n                type: \"post\",\r\n                data: {\r\n                    cycle_id: cycle.id,\r\n                    longitude: longitude.value,\r\n                    latitude: latitude.value,\r\n                },\r\n                headers: {\r\n                    Authorization: \"Bearer \" + store.state.user.token,\r\n                },\r\n                success(resp) {\r\n                    console.log(resp);\r\n                    if (resp.error_message === \"success\") {\r\n                        router.push({ name: \"cycle_run\" });\r\n                    }\r\n                },\r\n                error() {\r\n                    console.log(cycle.id);\r\n                    console.log(longitude);\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n\r\n        refresh_cycles();\r\n        return {\r\n            cycles,\r\n            cycleAdd,\r\n            add_cycle,\r\n            remove_cycle,\r\n            update_cycle,\r\n            cycle_run,\r\n        }\r\n\r\n    }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.error-message {\r\n    color: red;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}